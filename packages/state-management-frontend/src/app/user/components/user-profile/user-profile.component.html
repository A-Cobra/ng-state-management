<ng-container *ngIf="isSending">
  <state-management-app-loader></state-management-app-loader>
</ng-container>
<form [formGroup]="profileForm" autocomplete="off" class="profile__form">
  <fieldset class="profile__form__wrapper">
    <legend class="profile__title">Profile</legend>
    <div class="profile__form__control">
      <clapp-text-input
        #nameRef
        formControlName="name"
        [success]="
          getControl('name').valid &&
          !getControl('name').disabled &&
          !getControl('name').pristine
        "
        [error]="
          getControl('name').invalid &&
          !getControl('name').disabled &&
          !getControl('name').pristine
        "
        id="nameInput"
        name="nameInput"
        label="Name*"
        type="text"
      ></clapp-text-input>
      <clapp-helper-text
        *ngIf="
          !getControl('name').disabled &&
          getControl('name').hasError('required') &&
          !getControl('name').pristine
        "
        [textState]="getControl('name').disabled ? 'disabled' : 'default'"
        id="nameInputRequiredError"
      >
        This field is required.
      </clapp-helper-text>
      <clapp-helper-text
        *ngIf="
          !getControl('name').disabled &&
          getControl('name').hasError('pattern') &&
          !getControl('name').pristine
        "
        [textState]="getControl('name').disabled ? 'disabled' : 'default'"
        id="nameInputPatternError"
      >
        This field must contain only letters. It cannot start or finish with a
        space.
      </clapp-helper-text>
    </div>
    <div class="profile__form__control">
      <clapp-text-input
        #lastNameRef
        [success]="
          getControl('lastName').valid &&
          !getControl('lastName').disabled &&
          !getControl('lastName').pristine
        "
        [error]="
          getControl('lastName').invalid &&
          !getControl('lastName').disabled &&
          !getControl('lastName').pristine
        "
        formControlName="lastName"
        id="lastNameInput"
        name="lastNameInput"
        label="Last name*"
        type="text"
      ></clapp-text-input>
      <clapp-helper-text
        *ngIf="
          !getControl('lastName').disabled &&
          getControl('lastName').hasError('required') &&
          !getControl('lastName').pristine
        "
        [textState]="getControl('lastName').disabled ? 'disabled' : 'default'"
        id="lastNameInputRequiredError"
      >
        This field is required.
      </clapp-helper-text>
      <clapp-helper-text
        *ngIf="
          !getControl('lastName').disabled &&
          getControl('lastName').hasError('pattern') &&
          !getControl('lastName').pristine
        "
        [textState]="getControl('lastName').disabled ? 'disabled' : 'default'"
        id="lastNameInputPatternError"
      >
        This field must contain only letters. It cannot start or finish with a
        space.
      </clapp-helper-text>
    </div>
  </fieldset>
  <fieldset class="profile__form__wrapper">
    <legend class="profile__subtitle">Contact information</legend>
    <div class="profile__form__control">
      <clapp-text-input
        #emailRef
        formControlName="email"
        [error]="
          getControl('email').invalid &&
          !getControl('email').disabled &&
          !getControl('email').pristine
        "
        [success]="
          getControl('email').valid &&
          !getControl('email').disabled &&
          !getControl('email').pristine
        "
        id="emailInput"
        name="emailInput"
        label="Email*"
        type="email"
      ></clapp-text-input>
      <clapp-helper-text
        *ngIf="
          !getControl('email').disabled &&
          getControl('email').hasError('required') &&
          !getControl('email').pristine
        "
        textState="default"
        id="emailInputRequiredError"
      >
        This field is required.
      </clapp-helper-text>
      <clapp-helper-text
        *ngIf="
          !getControl('email').disabled &&
          (getControl('email').hasError('email') ||
            getControl('email').hasError('pattern')) &&
          !getControl('email').pristine
        "
        textState="default"
        id="emailInputPatternError"
      >
        This field must contain a valid email.
      </clapp-helper-text>
    </div>
    <div class="profile__form__control">
      <clapp-text-input
        #phoneNumberRef
        formControlName="phoneNumber"
        [error]="
          getControl('phoneNumber').invalid &&
          !getControl('phoneNumber').disabled &&
          !getControl('phoneNumber').pristine
        "
        [success]="
          getControl('phoneNumber').valid &&
          !getControl('phoneNumber').disabled &&
          !getControl('phoneNumber').pristine
        "
        id="phoneNumberInput"
        name="phoneNumberInput"
        label="Phone number*"
        type="tel"
      ></clapp-text-input>
      <clapp-helper-text
        *ngIf="
          getControl('phoneNumber').hasError('required') &&
          !getControl('phoneNumber').pristine
        "
        textState="default"
        id="phoneNumberInputRequiredError"
      >
        This field is required.
      </clapp-helper-text>
      <clapp-helper-text
        *ngIf="
          getControl('phoneNumber').hasError('pattern') &&
          !getControl('phoneNumber').pristine
        "
        textState="default"
        id="phoneNumberInputPatternError"
      >
        This field must contain only numbers. 0-9
      </clapp-helper-text>
    </div>
  </fieldset>
  <div class="profile__form__actions">
    <!-- TODO: Add change password link  -->
    <a class="profile__link" [routerLink]="['']">Manage your password</a>
    <!-- TODO: Add back to page link -->
    <div class="profile__form__buttons">
      <clapp-button
        color="secondary"
        size="small"
        [disabled]="isSending"
        type="button"
        [routerLink]="['']"
        plusIcon="ri-arrow-go-back-fill"
        id="backButton"
      >
        Back
      </clapp-button>
      <clapp-button
        *ngIf="!isEditing"
        color="primary"
        size="small"
        (click)="onClickEdit()"
        type="button"
        plusIcon="ri-edit-fill"
        id="editButton"
      >
        Edit
      </clapp-button>
      <clapp-button
        *ngIf="isEditing"
        color="primary"
        size="small"
        [disabled]="profileForm.invalid || isSending"
        type="submit"
        (click)="onClickSave()"
        plusIcon="ri-save-fill"
        id="saveButton"
      >
        Save
      </clapp-button>
    </div>
  </div>
</form>
